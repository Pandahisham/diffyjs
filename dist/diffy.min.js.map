{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4c47dc9f9e13b1869d7f","webpack:///./src/index.js","webpack:///./src/Diffy.js","webpack:///./src/worker.js","webpack:///./~/worker-loader/createInlineWorker.js","webpack:///./src/utils.js","webpack:///./src/raf.js","webpack:///./src/capture.js"],"names":["create","resolution","sensitivity","threshold","debug","window","Error","tickFn","captureFn","logger_1","logger_2","Diffy","captureConfig","audio","video","width","height","sourceDimensions","w","h","onTick","values","onMotion","containerClassName","x","y","bind","currentImageData","previousImageData","resolutionX","resolutionY","sourceWidth","sourceHeight","worker","initialized","addEventListener","init","blob","videoEl","src","canvas","getContext","drawImage","ctx","translate","scale","frame1","frame2","data1","data","data2","length","buffer","ArrayBuffer","postMessage","blendImageData","set","Uint8ClampedArray","blendCanvasCtx","putImageData","getImageData","compare","toCanvas","rawCanvasEl","blend","loop","drawBlendImageFromBuffer","initDom","blendCanvasEl","then","forEach","mirror","toVideo","containerEl","document","createElement","className","setAttribute","headerEl","titleEl","innerText","toggleEl","appendChild","body","node","styles","innerHTML","createElements","injectCssStyles","options","instanceExists","VERSION","createOnceLog","counter","onceLog","log","arguments","$","selector","querySelector","round","number","abs","value","polarize","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","getUserMedia","constraints","successCallback","errorCallback","navigator","webkitGetUserMedia","mozGetUserMedia","Promise","reject","call","mediaDevices","undefined","capture","stream","URL","createObjectURL","catch","name","message","console","error"],"mappings":"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","file":"diffy.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"diffy\"] = factory();\n\telse\n\t\troot[\"diffy\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4c47dc9f9e13b1869d7f","/* eslint-disable no-console */\n\nimport Diffy from './Diffy';\nimport requestAnimFrame from './raf';\nimport capture from './capture';\n\nexport const create = ({ resolution, sensitivity, threshold, debug }) => {\n\n  if(!window) {\n    throw new Error('Diffy.js is meant to be used in the browser. :^) ');\n  }\n\n  if('Worker' in window) {\n    throw new Error('Diffy.js requires Web Workers. It looks like this environment does not support this feature. :(');\n  }\n\n  return Diffy.create({\n    tickFn: requestAnimFrame,\n    captureFn: capture,\n    resolution,\n    sensitivity,\n    threshold\n  });\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/*\n  TODO worker error handling\n*/\n\nimport Worker from 'worker-loader?inline!./worker';\nimport { createOnceLog, $ } from './utils';\n\n// tmp\nconst logger_1 = createOnceLog();\nconst logger_2 = createOnceLog();\n\nexport default class Diffy {\n\n  static instanceExists = false;\n  static VERSION = '1.0.0';\n\n  constructor({\n    tickFn = () => {},\n    captureFn = () => {},\n    captureConfig = {\n      audio: false,\n      video: {\n        width: 130,\n        height: 100\n      }\n    },\n    debug = false,\n    sourceDimensions = { w: 130, h: 100 },\n    onTick = (values) => {},\n    onMotion = (values) => {},\n    sensitivity = 0.5,\n    containerClassName = 'diffy--debug-view',\n    resolution = { x: 10, y: 5 }\n  }) {\n\n    this.tickFn = tickFn.bind(window);\n    this.captureFn = captureFn;\n\n    this.currentImageData = null;\n    this.previousImageData = null;\n\n    this.resolutionX = resolution.x;\n    this.resolutionY = resolution.y;\n\n    this.sensitivity = sensitivity;\n\n    this.debug = debug;\n    this.containerClassName = containerClassName;\n\n    this.captureConfig = captureConfig;\n\n    this.sourceWidth = sourceDimensions.w;\n    this.sourceHeight = sourceDimensions.h;\n\n    this.worker = new Worker;\n\n    this.initialized = false;\n\n    window.addEventListener('load', this.init.bind(this));\n  }\n\n  toVideo(blob, videoEl) {\n    // piping blob to video element\n    videoEl.src = blob;\n  }\n\n  toCanvas(video, canvas) {\n    // piping video to canvas\n    canvas\n      .getContext('2d')\n      .drawImage(video, 0, 0, canvas.width, canvas.height);\n  }\n\n\n  mirror(canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.translate(canvas.width, 0);\n    ctx.scale(-1, 1);\n    return canvas;\n  }\n\n  compare(frame1, frame2) {\n    // const length = frame1.length;\n\n    const data1 = frame1.data;\n    const data2 = frame2.data;\n    const length = data1.length;\n\n    const buffer = new ArrayBuffer(length);\n    this.worker.postMessage({\n      buffer,\n      data1,\n      data2,\n      sensitivity: this.sensitivity,\n      width: this.sourceWidth,\n      height: this.sourceHeight\n    });\n\n  }\n\n  drawBlendImageFromBuffer(buffer) {\n    this.blendImageData\n      .data\n      .set(\n        new Uint8ClampedArray(buffer)\n      );\n\n    this.blendCanvasCtx.putImageData(this.blendImageData, 0, 0);\n    this.previousImageData = this.currentImageData;\n  }\n\n  /*\n    blend two consecutive frames\n    returns imageData\n  */\n  blend(canvas) {\n    const ctx = canvas.getContext('2d');\n    const width = canvas.width;\n    const height = canvas.height;\n    this.currentImageData = ctx.getImageData(0, 0, width, height);\n    this.previousImageData = this.previousImageData || ctx.getImageData(0, 0, width, height);\n    this.compare(this.currentImageData, this.previousImageData);\n  }\n\n  loop() {\n    this.toCanvas(this.videoEl, this.rawCanvasEl);\n    this.blend(this.rawCanvasEl);\n    this.tickFn(this.loop.bind(this));\n  }\n\n  init() {\n    this.worker.addEventListener('message', ({ data }) => {\n      this.drawBlendImageFromBuffer(data);\n    });\n\n    this.initDom(this.containerClassName);\n    this.blendCanvasCtx = this.blendCanvasEl.getContext('2d');\n    this.blendImageData = this.blendCanvasCtx.getImageData(0, 0, this.sourceWidth, this.sourceHeight);\n\n    this.captureFn(this.captureConfig).then((blob) => {\n      [this.rawCanvasEl, this.blendCanvasEl].forEach(this.mirror);\n      this.toVideo(blob, this.videoEl);\n      this.loop();\n    });\n    this.initialized = true;\n  }\n\n  createElements(containerClassName) {\n    this.containerEl = document.createElement('div');\n    this.containerEl.className = containerClassName;\n\n    this.videoEl = document.createElement('video');\n    this.videoEl.className = 'video view';\n    this.videoEl.setAttribute('autoplay', '');\n    this.videoEl.width = this.sourceWidth;\n    this.videoEl.height = this.sourceHeight;\n\n    this.rawCanvasEl = document.createElement('canvas');\n    this.rawCanvasEl.className = 'canvas--raw view';\n    this.rawCanvasEl.width = this.sourceWidth;\n    this.rawCanvasEl.height = this.sourceHeight;\n\n    this.blendCanvasEl = document.createElement('canvas');\n    this.blendCanvasEl.className = 'canvas--blend view';\n    this.blendCanvasEl.width = this.sourceWidth;\n    this.blendCanvasEl.height = this.sourceHeight;\n\n\n    this.headerEl = document.createElement('header');\n    this.headerEl.className = 'header';\n\n    this.titleEl = document.createElement('h1');\n    this.titleEl.className = 'title';\n    this.titleEl.innerText = 'Diffy debug view';\n\n    this.toggleEl = document.createElement('span');\n    this.toggleEl.className = 'toggle';\n    this.toggleEl.innerText = '-';\n\n    this.headerEl.appendChild(this.toggleEl);\n    this.headerEl.appendChild(this.titleEl);\n\n    this.containerEl.appendChild(this.headerEl);\n    this.containerEl.appendChild(this.videoEl);\n    this.containerEl.appendChild(this.rawCanvasEl);\n    this.containerEl.appendChild(this.blendCanvasEl);\n\n    document.body.appendChild(this.containerEl);\n  }\n\n  injectCssStyles() {\n    const node = document.createElement('style');\n    const containerClassName = this.containerClassName;\n    const styles = `\n      .${containerClassName} {\n        position: fixed;\n        top: 0;\n        left: 0;\n        font-family: monospace;\n        background-color: #000;\n        border: 4px solid #000;\n        color: #fff;\n      }\n      .${containerClassName} .header {\n        width: 100%;\n        background-color: #000;\n        font-size: 16px;\n      }\n      .${containerClassName} .title {\n        display: inline;\n        margin-left: 10px;\n        font-weight: 100;\n        font-size: 16px;\n      }\n      .${containerClassName} .toggle {\n        padding: 5px;\n        cursor: pointer;\n      }\n\n      .${containerClassName} .view {\n        padding: 5px;\n      }\n    `;\n    node.innerHTML = styles;\n    document.body.appendChild(node);\n  }\n\n  initDom(containerClassName) {\n    this.createElements(containerClassName);\n    this.injectCssStyles();\n\n  }\n\n  static create(options) {\n    if (Diffy.instanceExists) {\n      throw new Error(`It seems a diffy instance\n      already exists on this page.`);\n    }\n\n    Diffy.instanceExists = true;\n    return new this(options);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Diffy.js","module.exports = function() {\n\treturn require(\"!!/Users/maninilchiani/Self/diffyjs/node_modules/worker-loader/createInlineWorker.js\")(\"/******/ (function(modules) { // webpackBootstrap\\n/******/ \\t// The module cache\\n/******/ \\tvar installedModules = {};\\n/******/\\n/******/ \\t// The require function\\n/******/ \\tfunction __webpack_require__(moduleId) {\\n/******/\\n/******/ \\t\\t// Check if module is in cache\\n/******/ \\t\\tif(installedModules[moduleId])\\n/******/ \\t\\t\\treturn installedModules[moduleId].exports;\\n/******/\\n/******/ \\t\\t// Create a new module (and put it into the cache)\\n/******/ \\t\\tvar module = installedModules[moduleId] = {\\n/******/ \\t\\t\\texports: {},\\n/******/ \\t\\t\\tid: moduleId,\\n/******/ \\t\\t\\tloaded: false\\n/******/ \\t\\t};\\n/******/\\n/******/ \\t\\t// Execute the module function\\n/******/ \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n/******/\\n/******/ \\t\\t// Flag the module as loaded\\n/******/ \\t\\tmodule.loaded = true;\\n/******/\\n/******/ \\t\\t// Return the exports of the module\\n/******/ \\t\\treturn module.exports;\\n/******/ \\t}\\n/******/\\n/******/\\n/******/ \\t// expose the modules object (__webpack_modules__)\\n/******/ \\t__webpack_require__.m = modules;\\n/******/\\n/******/ \\t// expose the module cache\\n/******/ \\t__webpack_require__.c = installedModules;\\n/******/\\n/******/ \\t// __webpack_public_path__\\n/******/ \\t__webpack_require__.p = \\\"/\\\";\\n/******/\\n/******/ \\t// Load entry module and return exports\\n/******/ \\treturn __webpack_require__(0);\\n/******/ })\\n/************************************************************************/\\n/******/ ([\\n/* 0 */\\n/***/ function(module, exports, __webpack_require__) {\\n\\n\\t'use strict';\\n\\t\\n\\tvar _utils = __webpack_require__(1);\\n\\t\\n\\tvar logger_1 = (0, _utils.createOnceLog)();\\n\\t\\n\\tvar buffer = void 0;\\n\\tvar pixelData = void 0;\\n\\tvar data1 = void 0;\\n\\tvar data2 = void 0;\\n\\tvar average1 = void 0;\\n\\tvar average2 = void 0;\\n\\tvar width = void 0;\\n\\tvar height = void 0;\\n\\tvar delta = void 0;\\n\\tvar sensitivity = void 0;\\n\\tvar threshold = void 0;\\n\\t\\n\\tvar createDiffBuffer = function createDiffBuffer(_ref) {\\n\\t  var _ref$data = _ref.data,\\n\\t      buffer = _ref$data.buffer,\\n\\t      data1 = _ref$data.data1,\\n\\t      data2 = _ref$data.data2,\\n\\t      width = _ref$data.width,\\n\\t      height = _ref$data.height,\\n\\t      sensitivity = _ref$data.sensitivity;\\n\\t\\n\\t  var i = 0;\\n\\t  pixelData = new Uint32Array(buffer);\\n\\t  for (var y = 0; y < height; ++y) {\\n\\t    for (var x = 0; x < width; ++x) {\\n\\t      i = y * width + x;\\n\\t      average1 = (data1[i * 4] + data1[i * 4 + 1] + data1[i * 4 + 2]) / 3 / sensitivity;\\n\\t      average2 = (data2[i * 4] + data2[i * 4 + 1] + data2[i * 4 + 2]) / 3 / sensitivity;\\n\\t      delta = (0, _utils.polarize)((0, _utils.abs)(average1 - average2), 0x15);\\n\\t\\n\\t      pixelData[i] = 255 << 24 | // alpha\\n\\t      delta << 16 | // blue\\n\\t      delta << 8 | // green\\n\\t      delta; // red\\n\\t    }\\n\\t  }\\n\\t\\n\\t  postMessage(buffer);\\n\\t};\\n\\t\\n\\tonmessage = createDiffBuffer;\\n\\n/***/ },\\n/* 1 */\\n/***/ function(module, exports) {\\n\\n\\t\\\"use strict\\\";\\n\\t\\n\\tObject.defineProperty(exports, \\\"__esModule\\\", {\\n\\t  value: true\\n\\t});\\n\\t/* eslint-disable no-console */\\n\\t\\n\\t/*\\n\\t  utility function to log only once\\n\\t  useful for logging in loops\\n\\t*/\\n\\tvar createOnceLog = exports.createOnceLog = function createOnceLog() {\\n\\t  var counter = 0;\\n\\t  return function onceLog() {\\n\\t    if (counter < 1) {\\n\\t      var _console;\\n\\t\\n\\t      (_console = console).log.apply(_console, arguments);\\n\\t    }\\n\\t    counter++;\\n\\t  };\\n\\t};\\n\\t\\n\\t/*\\n\\t  utility function to access DOM references\\n\\t*/\\n\\tvar $ = exports.$ = function $(selector) {\\n\\t  return document.querySelector(selector);\\n\\t};\\n\\t\\n\\t/*\\n\\t  bitwise Math.round\\n\\t*/\\n\\tvar round = exports.round = function round(number) {\\n\\t  return number + .5 >> 0;\\n\\t};\\n\\t\\n\\t/*\\n\\t  butwise Math.abs\\n\\t*/\\n\\tvar abs = exports.abs = function abs(value) {\\n\\t  return (value ^ value >> 31) - (value >> 31);\\n\\t};\\n\\t\\n\\t/*\\n\\t  polarize pixel values based on value and threshold\\n\\t*/\\n\\tvar polarize = exports.polarize = function polarize(value, threshold) {\\n\\t  return value > threshold ? 0x00 : 0XFF;\\n\\t};\\n\\n/***/ }\\n/******/ ]);\\n//# sourceMappingURL=7549200f45b2591e1ba9.worker.js.map\", __webpack_public_path__ + \"7549200f45b2591e1ba9.worker.js\");\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/worker-loader?inline!./src/worker.js\n// module id = 3\n// module chunks = 0","// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\r\n\r\nvar URL = window.URL || window.webkitURL;\r\nmodule.exports = function(content, url) {\r\n\ttry {\r\n\t\ttry {\r\n\t\t\tvar blob;\r\n\t\t\ttry { // BlobBuilder = Deprecated, but widely implemented\r\n\t\t\t\tvar BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\r\n\t\t\t\tblob = new BlobBuilder();\r\n\t\t\t\tblob.append(content);\r\n\t\t\t\tblob = blob.getBlob();\r\n\t\t\t} catch(e) { // The proposed API\r\n\t\t\t\tblob = new Blob([content]);\r\n\t\t\t}\r\n\t\t\treturn new Worker(URL.createObjectURL(blob));\r\n\t\t} catch(e) {\r\n\t\t\treturn new Worker('data:application/javascript,' + encodeURIComponent(content));\r\n\t\t}\r\n\t} catch(e) {\r\n\t\treturn new Worker(url);\r\n\t}\r\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/worker-loader/createInlineWorker.js\n// module id = 4\n// module chunks = 0","/* eslint-disable no-console */\n\n/*\n  utility function to log only once\n  useful for logging in loops\n*/\nexport const createOnceLog = () => {\n  let counter = 0;\n  return function onceLog() {\n    if(counter < 1) {\n      console.log(...arguments);\n    }\n    counter ++;\n  }\n}\n\n/*\n  utility function to access DOM references\n*/\nexport const $ = (selector) => document.querySelector(selector);\n\n/*\n  bitwise Math.round\n*/\nexport const round = (number) => (number + .5) >> 0;\n\n/*\n  butwise Math.abs\n*/\nexport const abs = (value) => (value ^ (value >> 31)) - (value >> 31);\n\n\n/*\n  polarize pixel values based on value and threshold\n*/\nexport const polarize = (value, threshold) => (value > threshold) ? 0x00 : 0XFF;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","/*\n  shim requestAnimationFrame api\n  source: http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n*/\nconst requestAnimFrame =\n  window.requestAnimationFrame       ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame    ||\n  window.oRequestAnimationFrame      ||\n  window.msRequestAnimationFrame     ||\n  function(callback) {\n    window.setTimeout(callback, 1000 / 60);\n  };\n\nexport default requestAnimFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./src/raf.js","/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n/*\n  shim getUserMedia with a Promise api\n  source: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n*/\nconst getUserMedia = (constraints, successCallback, errorCallback) => {\n\n  // First get a hold of getUserMedia, if present\n  const getUserMedia = (navigator.getUserMedia ||\n      navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia);\n\n  // Some browsers just don't implement it - return a rejected promise with an error\n  // to keep a consistent interface\n  if(!getUserMedia) {\n    return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n  }\n\n  // Otherwise, wrap the call to the old navigator.getUserMedia with a Promise\n  return new Promise((successCallback, errorCallback) => {\n    getUserMedia.call(navigator, constraints, successCallback, errorCallback);\n  });\n\n}\n\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nif(navigator.mediaDevices === undefined) {\n  navigator.mediaDevices = {};\n}\n\n// Some browsers partially implement mediaDevices. We can't just assign an object\n// with getUserMedia as it would overwrite existing properties.\n// Here, we will just add the getUserMedia property if it's missing.\nif(navigator.mediaDevices.getUserMedia === undefined) {\n  navigator.mediaDevices.getUserMedia = getUserMedia;\n}\n\n/*\n  capture from camera\n  returns objectUrl\n */\nconst capture = (constraints) => {\n  return navigator.mediaDevices.getUserMedia(constraints)\n    .then((stream) => window.URL.createObjectURL(stream))\n    .catch(({ name, message }) => console.error(`${name} : ${message}`));\n}\n\nexport default capture;\n\n\n\n// WEBPACK FOOTER //\n// ./src/capture.js"],"sourceRoot":""}