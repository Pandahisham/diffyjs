!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.diffy=t():e.diffy=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=void 0;var a=n(2),r=i(a),o=n(6),s=i(o),u=n(7),d=i(u);n(5),t.create=function(e){var t=e.resolution;return console.log("Create called"),r.default.create({tickFn:s.default,captureFn:d.default,debug:!0,resolution:t})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(3),s=i(o),u=n(5),d=((0,u.createOnceLog)(),function(){function e(t){var n=t.tickFn,i=void 0===n?function(){}:n,r=t.captureFn,o=void 0===r?function(){}:r,u=t.captureConfig,d=void 0===u?{audio:!1,video:{width:130,height:100}}:u,c=t.debug,l=void 0!==c&&c,h=t.sourceDimensions,v=void 0===h?{w:130,h:100}:h,f=(t.onTick,t.onMotion,t.sensitivity),g=void 0===f?.5:f,m=t.containerClassName,p=void 0===m?"diffy--debug-view":m,w=t.resolution,b=void 0===w?{x:10,y:5}:w;a(this,e),this.tickFn=i.bind(window),this.captureFn=o,this.currentImageData=null,this.previousImageData=null,this.resolutionX=b.x,this.resolutionY=b.y,this.sensitivity=g,this.debug=l,this.containerClassName=p,this.captureConfig=d,this.sourceWidth=v.w,this.sourceHeight=v.h,this.worker=new s.default,this.initialized=!1,window.addEventListener("load",this.init.bind(this))}return r(e,[{key:"toVideo",value:function(e,t){t.src=e}},{key:"toCanvas",value:function(e,t){t.getContext("2d").drawImage(e,0,0,t.width,t.height)}},{key:"mirror",value:function(e){var t=e.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),e}},{key:"compare",value:function(e,t){var n=e.length,i=e.data,a=t.data,r=new ArrayBuffer(n);this.worker.postMessage({buffer:r,data1:i,data2:a,sensitivity:this.sensitivity,width:this.sourceWidth,height:this.sourceHeight})}},{key:"drawBlendImage",value:function(e){var t=e.data;this.blendImageData.data.set(new Uint8ClampedArray(t)),this.blendCanvasCtx.putImageData(this.blendImageData,0,0),this.previousImageData=this.currentImageData}},{key:"blend",value:function(e){var t=e.getContext("2d"),n=e.width,i=e.height;this.currentImageData=t.getImageData(0,0,n,i),this.previousImageData=this.previousImageData||t.getImageData(0,0,n,i),this.compare(this.currentImageData,this.previousImageData)}},{key:"loop",value:function(){this.toCanvas(this.videoEl,this.rawCanvasEl),this.blend(this.rawCanvasEl),this.tickFn(this.loop.bind(this))}},{key:"init",value:function(){var e=this;console.log("DOM ready. Init..."),this.worker.addEventListener("message",this.drawBlendImage.bind(this)),this.createElements(this.containerClassName),this.blendCanvasCtx=this.blendCanvasEl.getContext("2d"),this.blendImageData=this.blendCanvasCtx.getImageData(0,0,this.sourceWidth,this.sourceHeight),this.captureFn(this.captureConfig).then(function(t){[e.rawCanvasEl,e.blendCanvasEl].forEach(e.mirror),e.toVideo(t,e.videoEl),e.loop()}),this.initialized=!0}},{key:"createElements",value:function(e){this.containerEl=document.createElement("div"),this.containerEl.className=e,this.videoEl=document.createElement("video"),this.videoEl.className="debug--video",this.videoEl.setAttribute("autoplay",""),this.videoEl.width=this.sourceWidth,this.videoEl.height=this.sourceHeight,this.rawCanvasEl=document.createElement("canvas"),this.rawCanvasEl.className="debug--raw-canvas",this.rawCanvasEl.width=this.sourceWidth,this.rawCanvasEl.height=this.sourceHeight,this.blendCanvasEl=document.createElement("canvas"),this.blendCanvasEl.className="debug--blend-canvas",this.blendCanvasEl.width=this.sourceWidth,this.blendCanvasEl.height=this.sourceHeight,this.headerEl=document.createElement("div"),this.headerEl.className="debug--header",this.titleEl=document.createElement("h6"),this.titleEl.className="debug--title",this.titleEl.innerText="Diffy debug view",this.toggleEl=document.createElement("span"),this.toggleEl.innerText="-",this.headerEl.appendChild(this.toggleEl),this.headerEl.appendChild(this.titleEl),this.containerEl.appendChild(this.headerEl),this.containerEl.appendChild(this.videoEl),this.containerEl.appendChild(this.rawCanvasEl),this.containerEl.appendChild(this.blendCanvasEl),document.body.appendChild(this.containerEl)}}],[{key:"create",value:function(t){if(e.instanceExists)throw new Error("It seems a diffy instance\n      already exists on this page.");return new this(t)}},{key:"VERSION",get:function(){return"1.0.0"}},{key:"instanceExists",get:function(){return!1},set:function(t){e.instanceExists=t}}]),e}());t.default=d},function(e,t,n){e.exports=function(){return n(4)('!function(r){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=r,e.c=t,e.p="/",e(0)}([function(r,e,t){"use strict";var n,o,a,u,i,c,f,s,d,l,p,v=t(1),g=(0,v.createOnceLog)(),x=function(r){var e;g(r),n=r.data,o=n.buffer,u=n.data1,i=n.data2,s=n.width,d=n.height,p=n.sensitivity,a=new Uint32Array(o);for(var t=0;t<d;++t)for(var x=0;x<s;++x)e=t*s+x,c=(u[4*e]+u[4*e+1]+u[4*e+2])/3/1,f=(i[4*e]+i[4*e+1]+i[4*e+2])/3/1,l=(0,v.polarize)((0,v.abs)(c-f),21),a[e]=255<<24|l<<16|l<<8|l;g(o)};onmessage=x},function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.createOnceLog=function(){var r=0;return function(){if(r<1){var e;(e=console).log.apply(e,arguments)}r++}},e.$=function(r){return document.querySelector(r)},e.round=function(r){return r+.5>>0},e.abs=function(r){return(r^r>>31)-(r>>31)},e.polarize=function(r,e){return r>e?16711731:255}}]);\n//# sourceMappingURL=b2706f17fe619ece6081.worker.js.map',n.p+"b2706f17fe619ece6081.worker.js")}},function(e,t){var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var i;try{var a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;i=new a,i.append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(n.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.createOnceLog=function(){var e=0;return function(){if(e<1){var t;(t=console).log.apply(t,arguments)}e++}},t.$=function(e){return document.querySelector(e)},t.round=function(e){return e+.5>>0},t.abs=function(e){return(e^e>>31)-(e>>31)},t.polarize=function(e,t){return e>t?16711731:255}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.default=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function e(t,n,i){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise(function(n,i){e.call(navigator,t,n,i)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=n);var i=function(e){return navigator.mediaDevices.getUserMedia(e).then(function(e){return window.URL.createObjectURL(e)}).catch(function(e){var t=e.name,n=e.message;return console.error(t+" : "+n)})};t.default=i}])});
//# sourceMappingURL=diffy.min.js.map