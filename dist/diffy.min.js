!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.diffy=t():e.diffy=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="/",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=void 0;var a=i(2),r=n(a),o=i(5),s=n(o),u=i(6),d=n(u);i(7),t.create=function(e){var t=e.resolution;return console.log("Create called"),r.default.create({tickFn:s.default,captureFn:d.default,debug:!0,resolution:t})}},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(3),s=n(o),u=function(){function e(t){var i=t.tickFn,n=void 0===i?function(){}:i,r=t.captureFn,o=void 0===r?function(){}:r,u=t.captureConfig,d=void 0===u?{audio:!1,video:{width:130,height:100}}:u,c=t.debug,l=void 0!==c&&c,h=t.sourceDimensions,v=void 0===h?{w:130,h:100}:h,f=(t.onTick,t.onMotion,t.sensitivity),g=void 0===f?.5:f,p=t.containerClassName,m=void 0===p?"diffy--debug-view":p,w=t.resolution,b=void 0===w?{x:10,y:5}:w;a(this,e),this.tickFn=n.bind(window),this.captureFn=o,this.currentImageData=null,this.previousImageData=null,this.resolutionX=b.x,this.resolutionY=b.y,this.sensitivity=g,this.debug=l,this.containerClassName=m,this.captureConfig=d,this.sourceWidth=v.w,this.sourceHeight=v.h,this.worker=new s.default,this.initialized=!1,window.addEventListener("load",this.init.bind(this))}return r(e,[{key:"toVideo",value:function(e,t){t.src=e}},{key:"toCanvas",value:function(e,t){t.getContext("2d").drawImage(e,0,0,t.width,t.height)}},{key:"mirror",value:function(e){var t=e.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),e}},{key:"compare",value:function(e,t){var i=e.length,n=e.data,a=t.data,r=new ArrayBuffer(i);this.worker.postMessage({buffer:r,data1:n,data2:a,sensitivity:this.sensitivity,width:this.sourceWidth,height:this.sourceHeight})}},{key:"drawBlendImage",value:function(e){var t=e.data;this.blendImageData.data.set(new Uint8ClampedArray(t)),this.blendCanvasCtx.putImageData(this.blendImageData,0,0),this.previousImageData=this.currentImageData}},{key:"blend",value:function(e){var t=e.getContext("2d"),i=e.width,n=e.height;this.currentImageData=t.getImageData(0,0,i,n),this.previousImageData=this.previousImageData||t.getImageData(0,0,i,n),this.compare(this.currentImageData,this.previousImageData)}},{key:"loop",value:function(){this.toCanvas(this.videoEl,this.rawCanvasEl),this.blend(this.rawCanvasEl),this.tickFn(this.loop.bind(this))}},{key:"init",value:function(){var e=this;console.log("DOM ready. Init..."),this.worker.addEventListener("message",this.drawBlendImage.bind(this)),this.createElements(this.containerClassName),this.blendCanvasCtx=this.blendCanvasEl.getContext("2d"),this.blendImageData=this.blendCanvasCtx.getImageData(0,0,this.sourceWidth,this.sourceHeight),this.captureFn(this.captureConfig).then(function(t){[e.rawCanvasEl,e.blendCanvasEl].forEach(e.mirror),e.toVideo(t,e.videoEl),e.loop()}),this.worker.postMessage({bar:"foo"}),this.initialized=!0}},{key:"createElements",value:function(e){this.containerEl=document.createElement("div"),this.containerEl.className=e,this.videoEl=document.createElement("video"),this.videoEl.className="debug--video",this.videoEl.setAttribute("autoplay",""),this.videoEl.width=this.sourceWidth,this.videoEl.height=this.sourceHeight,this.rawCanvasEl=document.createElement("canvas"),this.rawCanvasEl.className="debug--raw-canvas",this.rawCanvasEl.width=this.sourceWidth,this.rawCanvasEl.height=this.sourceHeight,this.blendCanvasEl=document.createElement("canvas"),this.blendCanvasEl.className="debug--blend-canvas",this.blendCanvasEl.width=this.sourceWidth,this.blendCanvasEl.height=this.sourceHeight,this.headerEl=document.createElement("div"),this.headerEl.className="debug--header",this.titleEl=document.createElement("h6"),this.titleEl.className="debug--title",this.titleEl.innerText="Diffy debug view",this.toggleEl=document.createElement("span"),this.toggleEl.innerText="-",this.headerEl.appendChild(this.toggleEl),this.headerEl.appendChild(this.titleEl),this.containerEl.appendChild(this.headerEl),this.containerEl.appendChild(this.videoEl),this.containerEl.appendChild(this.rawCanvasEl),this.containerEl.appendChild(this.blendCanvasEl),document.body.appendChild(this.containerEl)}}],[{key:"create",value:function(t){if(e.instanceExists)throw new Error("It seems a diffy instance\n      already exists on this page.");return new this(t)}},{key:"VERSION",get:function(){return"1.0.0"}},{key:"instanceExists",get:function(){return!1},set:function(t){e.instanceExists=t}}]),e}();t.default=u},function(e,t,i){e.exports=function(){return i(4)('!function(r){function e(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return r[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=r,e.c=t,e.p="/",e(0)}([function(r,e,t){"use strict";var n,o,a,u,i,c,s,f,d,l,p,v=t(1),g=function(r){var e;n=r.data,o=n.buffer,u=n.data1,i=n.data2,f=n.width,d=n.height,p=n.sensitivity,a=new Uint32Array(o);for(var t=0;t<d;++t)for(var g=0;g<f;++g)e=t*f+g,c=(u[4*e]+u[4*e+1]+u[4*e+2])/3/1,s=(i[4*e]+i[4*e+1]+i[4*e+2])/3/1,l=(0,v.polarize)((0,v.abs)(c-s),21),a[e]=255<<24|l<<16|l<<8|l;postMessage(o)};onmessage=g},function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.createOnceLog=function(){var r=0;return function(){if(r<1){var e;(e=console).log.apply(e,arguments)}r++}},e.$=function(r){return document.querySelector(r)},e.round=function(r){return r+.5>>0},e.abs=function(r){return(r^r>>31)-(r>>31)},e.polarize=function(r,e){return r>e?16711731:255}}]);\n//# sourceMappingURL=e007241cdc41c4b0b949.worker.js.map',i.p+"e007241cdc41c4b0b949.worker.js")}},function(e,t){var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{var a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;n=new a,n.append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(i.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t,i,n){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise(function(i,n){e.call(navigator,t,i,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=i);var n=function(e){return navigator.mediaDevices.getUserMedia(e).then(function(e){return window.URL.createObjectURL(e)}).catch(function(e){var t=e.name,i=e.message;return console.error(t+" : "+i)})};t.default=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.createOnceLog=function(){var e=0;return function(){if(e<1){var t;(t=console).log.apply(t,arguments)}e++}},t.$=function(e){return document.querySelector(e)},t.round=function(e){return e+.5>>0},t.abs=function(e){return(e^e>>31)-(e>>31)},t.polarize=function(e,t){return e>t?16711731:255}}])});
//# sourceMappingURL=diffy.min.js.map